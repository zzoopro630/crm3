# í¼ìŠ¤íŠ¸ì±„ë„ CRM v3 - ì‘ì—…ì§€ì‹œì„œ

## í”„ë¡œì íŠ¸ ê°œìš”

### ëª©ì 
í•œêµ­í˜• ê³ ê° ê´€ë¦¬ ì‹œìŠ¤í…œ(CRM)ìœ¼ë¡œ, ê³ ê° ì •ë³´ ê´€ë¦¬, íŒ€ ê´€ë¦¬, ê´€ë¦¬ì ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

### ì£¼ìš” ë³€ê²½ì‚¬í•­
- **í”„ë¡ íŠ¸ì—”ë“œ**: React + Vite (ê²½ëŸ‰í™”, ë¹ ë¥¸ ê°œë°œ ì„œë²„)
- **ë³´ì•ˆ ê°•í™”**: ìµœì‹  ë³´ì•ˆ íŒ¨ì¹˜ ì ìš©, RLS ì •ì±… ê°•í™”
- **ì•„í‚¤í…ì²˜ ê°œì„ **: ìƒíƒœ ê´€ë¦¬ ì²´ê³„í™”, API ë ˆì´ì–´ ë¶„ë¦¬
- **ë°±ì—”ë“œ** : Hono, pages functions ì´ìš©í•´ì„œ ë°°í¬ (ì ˆëŒ€ workersë¡œ ë¶„ë¦¬í•˜ì§€ ë§ê²ƒ)
- **ORM** : drizzle (SQL Editorë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš° drizzleë¡œ ë³€ê²½)

---

## ê¸°ìˆ  ìŠ¤íƒ

### Frontend
| íŒ¨í‚¤ì§€ | ë²„ì „ | ìš©ë„ |
|--------|------|------|
| React | 19.x.x | latest |UI ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| Vite | 7.x | latest | ë¹Œë“œ ë„êµ¬ |
| React Router | 7.x | latest | í´ë¼ì´ì–¸íŠ¸ ë¼ìš°íŒ… |
| TanStack Query | 5.90.x | ì„œë²„ ìƒíƒœ ê´€ë¦¬ |
| Zustand | 5.0.x | í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê´€ë¦¬ |
| React Hook Form | latest | í¼ ê´€ë¦¬ |
| Zod | latest | ìŠ¤í‚¤ë§ˆ ê²€ì¦ |
| Tailwind CSS | 4.x | ìŠ¤íƒ€ì¼ë§ |
| Shadcn UI (Radix) | latest | UI ì»´í¬ë„ŒíŠ¸ |
| Lucide React | latest | ì•„ì´ì½˜ |
| Recharts | latest | ì°¨íŠ¸ |
| ExcelJS | latest | Excel íŒŒì¼ ì²˜ë¦¬ |

### Backend (ìœ ì§€)
| íŒ¨í‚¤ì§€ | ë²„ì „ | ìš©ë„ |
|--------|------|------|
| Hono | 4.x | latest | API í”„ë ˆì„ì›Œí¬ |


### Database
| ì„œë¹„ìŠ¤ | ìš©ë„ |
|--------|------|
| Supabase | PostgreSQL + Auth |

---

## ë³´ì•ˆ ìš”êµ¬ì‚¬í•­

### ğŸ”´ Critical

1. **í™˜ê²½ ë³€ìˆ˜ ë¶„ë¦¬**
   - `VITE_*` ì ‘ë‘ì‚¬: í”„ë¡ íŠ¸ì—”ë“œ ê³µê°œ í‚¤ë§Œ
   - `SUPABASE_SERVICE_ROLE_KEY`: ë°±ì—”ë“œ ì „ìš©, ì ˆëŒ€ ë…¸ì¶œ ê¸ˆì§€
   - í”„ë¡œë•ì…˜ ë°°í¬ ì „ ëª¨ë“  ì‹œí¬ë¦¿ íšŒì „

2. **RLS (Row Level Security) ì •ì±…**
   ```sql
   -- customers í…Œì´ë¸”
   - staff: ë³¸ì¸ì´ ë“±ë¡í•œ ê³ ê°ë§Œ ì¡°íšŒ/ìˆ˜ì •
   - manager: ë³¸ì¸ + íŒ€ì›ì´ ë“±ë¡í•œ ê³ ê° ì¡°íšŒ/ìˆ˜ì •
   - admin: ì „ì²´ ì¡°íšŒ/ìˆ˜ì •

   -- profiles í…Œì´ë¸”
   - ë³¸ì¸ í”„ë¡œí•„ë§Œ ì¡°íšŒ
   - adminë§Œ ì „ì²´ í”„ë¡œí•„ ì¡°íšŒ/ìˆ˜ì •
   ```

3. **API ë³´ì•ˆ**
   - JWT í† í° ê²€ì¦ í•„ìˆ˜
   - Rate limiting êµ¬í˜„
   - Input validation (Zod ìŠ¤í‚¤ë§ˆ)

### ğŸŸ¡ Important

4. **ì—ëŸ¬ í•¸ë“¤ë§**
   - ê¸€ë¡œë²Œ ì—ëŸ¬ ë°”ìš´ë”ë¦¬
   - API ì—ëŸ¬ ì‘ë‹µ í‘œì¤€í™”
   - ë¯¼ê° ì •ë³´ ë¡œê¹… ê¸ˆì§€

5. **ì¸ì¦ í”Œë¡œìš°**
   - Google OAuth 2.0 via Supabase
   - ì„¸ì…˜ ìë™ ê°±ì‹ 
   - ë¡œê·¸ì•„ì›ƒ ì‹œ ì™„ì „í•œ ì„¸ì…˜ ì •ë¦¬

---

## ë³´ì•ˆë“±ê¸‰ ì²´ê³„ ë° ê¶Œí•œ (ì‘ì—…ê³„íš)

### ë³´ì•ˆë“±ê¸‰ ì •ì˜

| ë“±ê¸‰ | ì§ê¸‰ | ì—­í•  (ê¸°ì¡´ ë§¤í•‘) | ì„¤ëª… |
|------|------|-----------------|------|
| **F1** | ìµœê³ ê´€ë¦¬ì | `admin` | ì‹œìŠ¤í…œ ì „ì²´ ê´€ë¦¬, ëª¨ë“  ë°ì´í„° ì ‘ê·¼ |
| **F2** | ì´ê´„ì´ì‚¬ | `manager` | ì‚°í•˜ ì „ì²´ ì¡°ì§ ê´€ë¦¬ |
| **F3** | ì‚¬ì—…ë‹¨ì¥ | - | ì‚°í•˜ ì§€ì  ê´€ë¦¬ |
| **F4** | ì§€ì ì¥ | - | ì‚°í•˜ íŒ€ ê´€ë¦¬ |
| **F5** | íŒ€ì¥ | - | ì‚°í•˜ FC ê´€ë¦¬ |
| **F6** | FC | `staff` | ë³¸ì¸ ê³ ê°ë§Œ ê´€ë¦¬ |

### ì¡°ì§ ê³„ì¸µ êµ¬ì¡°

```
F1 ìµœê³ ê´€ë¦¬ì (1ëª… ì´ìƒ)
    â””â”€â”€ F2 ì´ê´„ì´ì‚¬ (ì—¬ëŸ¬ ëª… ê°€ëŠ¥)
            â””â”€â”€ F3 ì‚¬ì—…ë‹¨ì¥ (ì—¬ëŸ¬ ëª… ê°€ëŠ¥)
                    â””â”€â”€ F4 ì§€ì ì¥ (ì—¬ëŸ¬ ëª… ê°€ëŠ¥)
                            â””â”€â”€ F5 íŒ€ì¥ (ì—¬ëŸ¬ ëª… ê°€ëŠ¥)
                                    â””â”€â”€ F6 FC (ì—¬ëŸ¬ ëª… ê°€ëŠ¥)
```

> **ì°¸ê³ **: ê° ë“±ê¸‰ì— ì—¬ëŸ¬ ì‚¬ëŒì´ ì¡´ì¬í•  ìˆ˜ ìˆìœ¼ë©°, ê° ì¡°ì§ ë‹¨ìœ„ë§ˆë‹¤ ê´€ë¦¬ìê°€ ì—¬ëŸ¬ ëª…ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤

#### ê³ ê° ì¡°íšŒ ê¶Œí•œ

| ë“±ê¸‰ | ì¡°íšŒ ë²”ìœ„ |
|------|----------|
| **F6 (FC)** | ë³¸ì¸ ê³ ê°ë§Œ |
| **F5 (íŒ€ì¥)** | ë³¸ì¸ + ì†Œì† FC ê³ ê° |
| **F4 (ì§€ì ì¥)** | ì§€ì  ì „ì²´ (íŒ€ì¥ + FC í¬í•¨) |
| **F3 (ì‚¬ì—…ë‹¨ì¥)** | ì‚¬ì—…ë‹¨ ì „ì²´ (ì§€ì ì¥ ì´í•˜ í¬í•¨) |
| **F2 (ì´ê´„ì´ì‚¬)** | ì´ê´„ ì¡°ì§ ì „ì²´ (ì‚¬ì—…ë‹¨ì¥ ì´í•˜ í¬í•¨) |
| **F1 (ìµœê³ ê´€ë¦¬ì)** | ì „ì²´ ì‹œìŠ¤í…œ |

#### ê³ ê° ë“±ë¡ ê¶Œí•œ

| ë“±ê¸‰ | ë“±ë¡ ê¶Œí•œ | ë°°ì • ê°€ëŠ¥ ëŒ€ìƒ |
|------|----------|--------------|
| **F6 (FC)** | âœ… | ë³¸ì¸ì—ê²Œë§Œ |
| **F5 (íŒ€ì¥)** | âœ… | ë³¸ì¸ ë˜ëŠ” ì†Œì† FC |
| **F4 (ì§€ì ì¥)** | âœ… | ì§€ì  ë‚´ ì¸ì› |
| **F3 (ì‚¬ì—…ë‹¨ì¥)** | âœ… | ì‚¬ì—…ë‹¨ ë‚´ ì¸ì› |
| **F2 (ì´ê´„ì´ì‚¬)** | âœ… | ì´ê´„ ì¡°ì§ ë‚´ ì¸ì› |
| **F1 (ìµœê³ ê´€ë¦¬ì)** | âœ… | ëˆ„êµ¬ì—ê²Œë‚˜ |

#### ê³ ê° ìˆ˜ì • ê¶Œí•œ

| ë“±ê¸‰ | ìˆ˜ì • ë²”ìœ„ |
|------|----------|
| **F6 (FC)** | ë³¸ì¸ ê³ ê°ë§Œ |
| **F5 (íŒ€ì¥)** | ë³¸ì¸ + ì†Œì† FC |
| **F4 (ì§€ì ì¥)** | ì§€ì  ë‚´ ì „ì²´ |
| **F3 (ì‚¬ì—…ë‹¨ì¥)** | ì‚¬ì—…ë‹¨ ë‚´ ì „ì²´ |
| **F2 (ì´ê´„ì´ì‚¬)** | ì´ê´„ ì¡°ì§ ë‚´ ì „ì²´ |
| **F1 (ìµœê³ ê´€ë¦¬ì)** | ì „ì²´ |

#### ê³ ê° ì‚­ì œ ê¶Œí•œ

| ë“±ê¸‰ | ì‚­ì œ ê¶Œí•œ |
|------|----------|
| **F6 ~ F2** | âœ… **ë³¸ì¸ì´ ë“±ë¡í•œ ê³ ê°ë§Œ** ì‚­ì œ ê°€ëŠ¥ |
| **F1 (ìµœê³ ê´€ë¦¬ì)** | âœ… ì „ì²´ (ì§€ì‚¬ ìš”ì²­ì— ë”°ë¼) |

> **ì •ì±… ê·¼ê±°**: 
> - ìƒìœ„ê´€ë¦¬ìê°€ í•˜ìœ„ì§ê¸‰ì˜ ê³ ê° ë°ì´í„°ë¥¼ ë§ˆìŒëŒ€ë¡œ ì‚­ì œí•˜ë©´ ì—…ë¬´ í˜¼ë€ ë°œìƒ
> - ê´€ë¦¬ìê°€ ë°°ì •í•œ ê³ ê°ì„ í•˜ìœ„ì§ê¸‰ì´ ì„ì˜ ì‚­ì œ ì‹œ ë¬¸ì œ ë°œìƒ
> - ë”°ë¼ì„œ **ë“±ë¡ì ë³¸ì¸**ë§Œ ì‚­ì œ ê¶Œí•œ ë³´ìœ  (ì±…ì„ ì†Œì¬ ëª…í™•í™”)
> - F1(ìµœê³ ê´€ë¦¬ì)ëŠ” ê° ì§€ì‚¬ ìš”ì²­ì— ë”°ë¼ ì‚­ì œ ì²˜ë¦¬

#### ë‹´ë‹¹ì ì´ê´€ ê¶Œí•œ

| ë“±ê¸‰ | ì´ê´€ ë²”ìœ„ |
|------|----------|
| **F6 (FC)** | âŒ ë¶ˆê°€ |
| **F5 (íŒ€ì¥)** | íŒ€ ë‚´ FC ê°„ |
| **F4 (ì§€ì ì¥)** | ì§€ì  ë‚´ ì¸ì› ê°„ |
| **F3 (ì‚¬ì—…ë‹¨ì¥)** | ì‚¬ì—…ë‹¨ ë‚´ ì¸ì› ê°„ |
| **F2 (ì´ê´„ì´ì‚¬)** | ì´ê´„ ì¡°ì§ ë‚´ ì¸ì› ê°„ |
| **F1 (ìµœê³ ê´€ë¦¬ì)** | ì „ì²´ ì¸ì› ê°„ |

### DB ìŠ¤í‚¤ë§ˆ ì„¤ê³„ (ì‘ì—…ê³„íš)

```sql
-- users í…Œì´ë¸” ìˆ˜ì •ì•ˆ
CREATE TABLE users (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  email TEXT NOT NULL,
  security_level TEXT NOT NULL DEFAULT 'F6' 
    CHECK (security_level IN ('F1', 'F2', 'F3', 'F4', 'F5', 'F6')),
  parent_id UUID REFERENCES users(id),  -- ì§ì† ìƒê¸‰ì
  position_name TEXT,  -- í‘œì‹œìš© ì§ê¸‰ëª… (ììœ  ì…ë ¥)
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- í•˜ìœ„ ì¡°ì§ì› ì¬ê·€ ì¡°íšŒ í•¨ìˆ˜
CREATE OR REPLACE FUNCTION get_subordinates(user_id UUID)
RETURNS TABLE(id UUID) AS $$
  WITH RECURSIVE subordinates AS (
    SELECT u.id FROM users u WHERE u.parent_id = user_id
    UNION ALL
    SELECT u.id FROM users u
    INNER JOIN subordinates s ON u.parent_id = s.id
  )
  SELECT id FROM subordinates;
$$ LANGUAGE SQL;
```

### ê¸°ì¡´ ì—­í• ê³¼ ë§¤í•‘

| ê¸°ì¡´ ì—­í•  | ìƒˆ ë³´ì•ˆë“±ê¸‰ |
|----------|-----------|
| `admin` | F1 (ìµœê³ ê´€ë¦¬ì) |
| `manager` | F2 (ì´ê´„ì´ì‚¬) |
| `staff` | F6 (FC) |

> **ë§ˆì´ê·¸ë ˆì´ì…˜**: ê¸°ì¡´ `admin`/`manager`/`staff` ì—­í• ì„ F1/F2/F6ìœ¼ë¡œ ë³€í™˜. F3~F5ëŠ” ìƒˆë¡œ ìƒì„±.

---

## ê¸°ëŠ¥ ëª…ì„¸ ë° ì‘ì—… ê³„íš (Status Update)

### âœ… Phase 1: ê¸°ë³¸ ì¸í”„ë¼ (ì™„ë£Œ)

#### 1.1 ì¸ì¦ ì‹œìŠ¤í…œ
- [ ] Google OAuth ë¡œê·¸ì¸
- [ ] ì„¸ì…˜ ê´€ë¦¬ (ìë™ ê°±ì‹ )
- [ ] ë¡œê·¸ì•„ì›ƒ
- [ ] ë³´í˜¸ëœ ë¼ìš°íŠ¸ (ProtectedRoute)
- [ ] ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (F1~F6 ì²´ê³„ ì ìš© ì¤‘)

#### 1.2 ë ˆì´ì•„ì›ƒ
- [ ] ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜
- [ ] ë°˜ì‘í˜• ë””ìì¸
- [ ] ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜
- [ ] ì‚¬ìš©ì ì •ë³´ í‘œì‹œ

---

### âœ… Phase 1.5: ì‚¬ì› ì¸ì¦ ë° ë³´ì•ˆ (ì™„ë£Œ)

> **ëª©ì **: êµ¬ê¸€ ë¡œê·¸ì¸ ì´ë©”ì¼ì„ ì‚¬ì› ë¦¬ìŠ¤íŠ¸ì™€ ë§¤ì¹­í•˜ì—¬ ì‹¤ëª…/ì†Œì†/ë³´ì•ˆë“±ê¸‰ ìë™ ì ìš©. (F1~F6)

#### âš¡ ê¸´ê¸‰ ì ê²€ ì‚¬í•­
- [ ] **Vite Proxy ì—°ê²° í™•ì¸**: Frontend(3000) <-> Backend(8787) í†µì‹  ì¥ì•  í•´ê²° (Firewall/Proxy ì„¤ì • ì ê²€)
- [ ] `vite.config.ts` Proxy ì„¤ì • ë° `Index.jsx` API í˜¸ì¶œ ê²½ë¡œ ê²€ì¦

#### 1.5.1 ì‚¬ì› ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬ (F1 ì „ìš©)
- [x] ì‚¬ì› ëª©ë¡ ì¡°íšŒ í™”ë©´
- [x] ì‚¬ì› ë“±ë¡ í¼ (ê°œë³„)
- [x] ì‚¬ì› ëŒ€ëŸ‰ ë“±ë¡ (Excel ì—…ë¡œë“œ)
- [x] ì‚¬ì› ì •ë³´ ìˆ˜ì •
- [x] ì‚¬ì› ë¹„í™œì„±í™”/ì‚­ì œ
- [x] ì‚¬ì› ëª©ë¡ ì»¬ëŸ¼ ìˆœì„œ ë³€ê²½ (ì´ë¦„â†’ì§ê¸‰â†’ì¡°ì§â†’ë³´ì•ˆë“±ê¸‰â†’ìƒìœ„ìâ†’ì´ë©”ì¼)
- [x] ë¹„í™œì„± ì‚¬ì› ê´€ë¦¬ ê¸°ëŠ¥ (í™œì„±/ë¹„í™œì„± íƒ­ ë¶„ë¦¬, ë³µì› ê¸°ëŠ¥)

#### 1.5.2 ì‹ ê·œ ë¡œê·¸ì¸ ì²˜ë¦¬
- [x] ì‹ ê·œ ë¡œê·¸ì¸ ì‹œ ì´ë©”ì¼ ë§¤ì¹­ ë¡œì§ (ê¸°ë³¸ êµ¬í˜„)
- [x] ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ ìŠ¹ì¸ ëŒ€ê¸° í™”ë©´ êµ¬í˜„

#### 1.5.3 ìŠ¹ì¸ ëŒ€ê¸° ê´€ë¦¬ (F1 ì „ìš©)
- [x] ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ ì¡°íšŒ ë° ì²˜ë¦¬

#### 1.5.4 ë‹´ë‹¹ì í‘œì‹œ ê°œì„ 
- [x] ê³ ê° ëª©ë¡ì˜ ë‹´ë‹¹ì ì»¬ëŸ¼: ì‹¤ëª… í‘œì‹œ
- [x] ë‹´ë‹¹ì ë“œë¡­ë‹¤ìš´: ì‹¤ëª… (ì†Œì†) í˜•ì‹

#### 1.5.5 Database Enumerated Types ì ìš©
- [x] PostgreSQL ENUM íƒ€ì… ìƒì„± (`security_level_enum`, `customer_status_enum`, `gender_enum` ë“±)
- [x] ê¸°ì¡´ VARCHAR ì»¬ëŸ¼ì„ ENUM íƒ€ì…ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
- [x] Drizzle ìŠ¤í‚¤ë§ˆ ì—…ë°ì´íŠ¸ (`src/db/schema.ts`)
- [x] í”„ë¡ íŠ¸ì—”ë“œ íƒ€ì… ì •ì˜ ë™ê¸°í™”

---

### âœ… Phase 2: ê³ ê° ê´€ë¦¬ (í•µì‹¬ ê¸°ëŠ¥) - ì™„ë£Œ

#### 2.1 ê³ ê° ëª©ë¡
- [x] í˜ì´ì§€ë„¤ì´ì…˜ (ì„œë²„ ì‚¬ì´ë“œ)
- [x] ê²€ìƒ‰ (ì´ë¦„, ì „í™”ë²ˆí˜¸)
- [x] í•„í„°ë§ (ìƒíƒœ, ë‹´ë‹¹ì)
- [x] ì •ë ¬ (ìƒì„±ì¼, ìˆ˜ì •ì¼)

#### 2.2 ê³ ê° ë“±ë¡
- [x] ê°œë³„ ë“±ë¡ ëª¨ë‹¬
- [x] í•„ë“œ ê²€ì¦ (ì „í™”ë²ˆí˜¸, ì´ë©”ì¼)
- [x] ì£¼ì†Œ ê²€ìƒ‰ (Juso API)
- [x] ì „í™”ë²ˆí˜¸ í¬ë§·íŒ… (kr-format)
- [x] ì¤‘ë³µ ì²´í¬

#### 2.3 ëŒ€ëŸ‰ ì—…ë¡œë“œ
- [x] Excel íŒŒì¼ ì—…ë¡œë“œ (ExcelJS)
- [x] ë¯¸ë¦¬ë³´ê¸° ë° ê²€ì¦
- [x] ì¤‘ë³µ í•„í„°ë§
- [x] ê²°ê³¼ ë¦¬í¬íŠ¸

#### 2.4 ê³ ê° ìƒì„¸/ìˆ˜ì •
- [x] ìƒì„¸ ì •ë³´ ì¡°íšŒ
- [x] ì •ë³´ ìˆ˜ì •
- [x] ìƒíƒœ ë³€ê²½
- [ ] ìˆ˜ì • ì´ë ¥ (ì¶”í›„ ê°œì„ )

#### 2.5 ë‹´ë‹¹ì ë³€ê²½ (ì‹ ê·œ ì¶”ê°€)
- [x] ë‹´ë‹¹ì í´ë¦­ ì‹œ íŒì˜¤ë²„ ë“œë¡­ë‹¤ìš´
- [x] í•˜ìœ„ ì§ì› ëª©ë¡ í‘œì‹œ (ê²€ìƒ‰ ê°€ëŠ¥)
- [x] ê¶Œí•œ ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (F5 ì´ìƒë§Œ ì´ê´€ ê°€ëŠ¥)
- [x] í˜„ì¬ ë‹´ë‹¹ì í‘œì‹œ ë° ì„ íƒ ë¶ˆê°€ ì²˜ë¦¬

#### 2.6 ëŒ€ëŸ‰ ì´ê´€ ê¸°ëŠ¥ (ì‹ ê·œ ì¶”ê°€)
- [x] ì²´í¬ë°•ìŠ¤ ì»¬ëŸ¼ ì¶”ê°€ (F5 ì´ìƒ ê¶Œí•œ ì‚¬ìš©ìì—ê²Œë§Œ í‘œì‹œ)
- [x] ì „ì²´ ì„ íƒ/í•´ì œ ì²´í¬ë°•ìŠ¤ (í…Œì´ë¸” í—¤ë”)
- [x] ì„ íƒëœ ê³ ê° ìˆ˜ í‘œì‹œ ë° ì•¡ì…˜ ë°” UI
- [x] ëŒ€ëŸ‰ ì´ê´€ ëª¨ë‹¬ (ë‹´ë‹¹ì ê²€ìƒ‰ ë° ì„ íƒ)
- [x] ì„ íƒëœ í–‰ ë°°ê²½ìƒ‰ í•˜ì´ë¼ì´íŠ¸ (ì„ íƒ ìƒíƒœ ì‹œê°ì  êµ¬ë¶„)
- [x] Shift+í´ë¦­ ë²”ìœ„ ì„ íƒ ê¸°ëŠ¥ (ë‹¤ì¤‘ ì„ íƒ í¸ì˜ì„±)
- [x] í˜ì´ì§€ ë³€ê²½ ì‹œ ì„ íƒ ì´ˆê¸°í™”

#### êµ¬í˜„ íŒŒì¼
- `src/components/ui/popover.tsx` - Radix Popover ì»´í¬ë„ŒíŠ¸
- `src/components/customers/ManagerSelector.tsx` - ë‹´ë‹¹ì ì„ íƒ ì»´í¬ë„ŒíŠ¸ (ê°œë³„ ì´ê´€)
- `src/components/customers/BulkTransferModal.tsx` - ëŒ€ëŸ‰ ì´ê´€ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
- `src/pages/CustomersPage.tsx` - ì²´í¬ë°•ìŠ¤, ì„ íƒ ìƒíƒœ ê´€ë¦¬, Shift ì„ íƒ ë¡œì§
- `src/services/team.ts` - transferCustomer, bulkTransferCustomers í•¨ìˆ˜
- `src/hooks/useTeam.ts` - useTransferCustomer, useBulkTransferCustomers í›…

---

### âœ… Phase 3: íŒ€ ê´€ë¦¬ (ì™„ë£Œ)

#### (ì¤‘ìš”) ì†Œì† ì„¤ì •
- ì¡°ì§(íŒ€) ìƒì„±, ìˆ˜ì •, ì‚­ì œ ê¸°ëŠ¥ í•„ìš”
- ì†Œì† ì„ íƒ (F1ì´ ì§€ì •)
- F1ì´ ìŠ¹ì¸í•˜ë©´ì„œ ì‹ ì²­ìì˜ ì†Œì†, ì¡°ì§ í™•ì¸í•˜ê³  ì„¤ì • (ì¶”í›„ ìˆ˜ì • ê°€ëŠ¥í•˜ë„ë¡)
- F1ì€ ìµœê³  ê´€ë¦¬ì, íŠ¹ì •í•œ ìƒí™©ì—ì„œ ê¶Œí•œ ë¶€ì—¬
- F2ëŠ” F1 ì†Œì†
- F3~F6ì€ F2 ì†Œì†, F4~F6ëŠ” F3 ì†Œì†, F5~6ì€ F4 ì†Œì†

#### 3.1 íŒ€ í˜„í™© (Managerìš©)
- [x] íŒ€ì› ëª©ë¡
- [x] íŒ€ì›ë³„ ê³ ê° ìˆ˜
- [x] íŒ€ í†µê³„ (ìƒíƒœë³„ ë¶„í¬)

#### 3.2 ê³ ê° ì´ê´€
- [x] ë‹´ë‹¹ì ë³€ê²½ (ì„œë¹„ìŠ¤ êµ¬í˜„)
- [x] ëŒ€ëŸ‰ ì´ê´€ (ì„œë¹„ìŠ¤ êµ¬í˜„)
- [x] ë‹´ë‹¹ì í•„í„°ë§ UI

### âœ… Phase 4: ê´€ë¦¬ì ê¸°ëŠ¥ (ì™„ë£Œ)

#### 4.0 ì¡°ì§ ê´€ë¦¬ âœ…
- [x] organizations í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì¶”ê°€
- [x] ì¡°ì§ ì„œë¹„ìŠ¤/í›… ìƒì„±
- [x] ì¡°ì§ ê´€ë¦¬ UI (ìƒì„±/ìˆ˜ì •/ì‚­ì œ)

#### 4.1 ì‚¬ìš©ì ê´€ë¦¬ âœ…
- [x] ì‚¬ìš©ì ëª©ë¡ ê°œì„  (ì¡°ì§ ì •ë³´ í‘œì‹œ)
- [x] ì—­í•  ë³€ê²½ (F1~F6)
- [x] ìƒìœ„ì ì§€ì •
- [x] ìŠ¹ì¸ í˜ì´ì§€ ì¡°ì§/ìƒìœ„ì ì„ íƒ UI

#### 4.2 ì†ŒìŠ¤ ê´€ë¦¬ âœ…
- [x] ì†ŒìŠ¤ ì„œë¹„ìŠ¤/í›… ìƒì„±
- [x] ì†ŒìŠ¤ ê´€ë¦¬ UI
- [x] ê³ ê° ë“±ë¡ ì‹œ ì†ŒìŠ¤ ë“œë¡­ë‹¤ìš´ ì—°ë™

---

### ì„¤ì • í˜ì´ì§€ êµ¬ì¡° (ê´€ë¦¬ì F1 ì „ìš©)

> í˜„ì¬ ë³„ë„ í˜ì´ì§€ë¡œ êµ¬í˜„ëœ ê´€ë¦¬ì ê¸°ëŠ¥ë“¤ì„ **ì„¤ì •** íƒ­ìœ¼ë¡œ í†µí•©

| íƒ­ | í˜„ì¬ ê²½ë¡œ | ì„¤ëª… |
|----|----------|------|
| ì¡°ì§ ê´€ë¦¬ | `/organizations` â†’ `/settings/organizations` | ì¡°ì§(íŒ€) ìƒì„±/ìˆ˜ì •/ì‚­ì œ |
| ì†ŒìŠ¤ ê´€ë¦¬ | `/sources` â†’ `/settings/sources` | ê³ ê° ìœ ì… ì±„ë„ ê´€ë¦¬ |
| ì‚¬ì› ê´€ë¦¬ | `/employees` â†’ `/settings/employees` | ì‚¬ì› ë“±ë¡/ìˆ˜ì •, ë³´ì•ˆë“±ê¸‰ ê´€ë¦¬ |
| ìŠ¹ì¸ ëŒ€ê¸° | `/approvals` â†’ `/settings/approvals` | ê°€ì… ìŠ¹ì¸/ê±°ì ˆ |
| ì‹œìŠ¤í…œ ì„¤ì • | (ì‹ ê·œ) | ë‹¤í¬ëª¨ë“œ, ì•± ì„¤ì • ë“± |

#### âœ… TODO: ì„¤ì • í˜ì´ì§€ í†µí•© (ì™„ë£Œ)
- [x] SettingsPage ë ˆì´ì•„ì›ƒ (íƒ­ í˜•íƒœ)
- [x] ì¡°ì§ ê´€ë¦¬ íƒ­ ì´ë™
- [x] ì†ŒìŠ¤ ê´€ë¦¬ íƒ­ ì´ë™
- [x] ì‚¬ì› ê´€ë¦¬ íƒ­ ì´ë™
- [x] ìŠ¹ì¸ ëŒ€ê¸° íƒ­ ì´ë™
- [x] ì‹œìŠ¤í…œ ì„¤ì • íƒ­
- [x] Sidebar ë„¤ë¹„ê²Œì´ì…˜ ì •ë¦¬ (ì¤‘ë³µ ë©”ë‰´ ì œê±°)
- [x] ê¸°ì¡´ ê²½ë¡œë“¤ /settingsë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

---

### âœ… Phase 5: ëŒ€ì‹œë³´ë“œ (ì™„ë£Œ)

#### 5.1 í†µê³„ ìœ„ì ¯
- [x] ì „ì²´ ê³ ê° ìˆ˜
- [x] ìƒíƒœë³„ ë¶„í¬ (ì‹ ê·œ/ì—°ë½ì™„ë£Œ/ìƒë‹´ì¤‘/ê³„ì•½ì™„ë£Œ)
- [x] ìµœê·¼ ë“±ë¡ ê³ ê° ë¦¬ìŠ¤íŠ¸
- [x] ê¶Œí•œë³„ ë°ì´í„° í•„í„°ë§ (F1: ì „ì²´, F2~F6: ë³¸ì¸ ë‹´ë‹¹)
- [ ] ê¸°ê°„ë³„ ì¶”ì´ ì°¨íŠ¸ (ì¶”í›„ ê°œì„ )
- [ ] íŒ€ ì„±ê³¼ (Managerìš©) (ì¶”í›„ ê°œì„ )

#### êµ¬í˜„ íŒŒì¼
- `src/services/dashboard.ts` - ëŒ€ì‹œë³´ë“œ í†µê³„ ì„œë¹„ìŠ¤
- `src/hooks/useDashboard.ts` - TanStack Query í›…
- `src/pages/DashboardPage.tsx` - UI ì»´í¬ë„ŒíŠ¸

---

### ğŸ“‹ Phase 6: ì¶”í›„ ê²€í†  ì‚¬í•­

#### 6.1 ë‚´ ê³„ì • í˜ì´ì§€ (ì‹ ê·œ)
- [ ] `/settings/profile` í˜ì´ì§€ êµ¬í˜„
- [ ] ë‚´ ì •ë³´ ì¡°íšŒ (ì´ë¦„, ì´ë©”ì¼, ë³´ì•ˆë“±ê¸‰, ì†Œì†)
- [ ] ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (Supabase Auth ì—°ë™)
- [ ] í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ (ì„ íƒ)

#### 6.2 íŒŒì¼ ë³´ê´€ ì €ì¥ì†Œ ê²€í† 
- [ ] Supabase Storage í™œìš© ê²€í† 
- [ ] Cloudflare R2 í™œìš© ê²€í† 
- [ ] Google File Search API ì‚¬ìš© ê³ ë ¤
- [ ] ê³ ê° ì„œë¥˜ PDF ë³´ê´€ ê¸°ëŠ¥ êµ¬í˜„

#### 6.3 UUID v7 ë§ˆì´ê·¸ë ˆì´ì…˜ ë° URL ë³´ì•ˆ
- [ ] UUID v4 â†’ v7 ë§ˆì´ê·¸ë ˆì´ì…˜ (employees, pendingApprovals í…Œì´ë¸”)
- [ ] customers í…Œì´ë¸” ID: Integer â†’ UUID v7 ë³€ê²½ ê²€í† 
  - ì¥ì : URLì—ì„œ ìˆœë²ˆ ì¶”ì¸¡ ë¶ˆê°€, ì¸ë±ìŠ¤ ì„±ëŠ¥ í–¥ìƒ (ì‹œê°„ìˆœ ì •ë ¬)
  - ê³ ë ¤ì‚¬í•­: ê´€ë ¨ FK (customerNotes, contracts) í•¨ê»˜ ë³€ê²½ í•„ìš”
- [ ] ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ ìˆ˜ë¦½
- [ ] PostgreSQL uuidv7 í™•ì¥ ë˜ëŠ” ì•± ë ˆë²¨ ìƒì„± ë°©ì‹ ê²°ì •

---

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

- ì„ íƒí•­ëª© ì²˜ë¦¬ëŠ” Database Enumerated Types ì‚¬ìš©í•  ê²ƒ.

### profiles
```sql
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  email TEXT NOT NULL,
  role TEXT NOT NULL CHECK (role IN ('admin', 'manager', 'staff')),
  manager_id UUID REFERENCES profiles(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### customers
```sql
CREATE TABLE customers (
  id SERIAL PRIMARY KEY,
  manager_id UUID NOT NULL REFERENCES profiles(id),
  name TEXT NOT NULL,
  phone TEXT,
  email TEXT,
  address TEXT,
  gender TEXT CHECK (gender IN ('ë‚¨ì„±', 'ì—¬ì„±', 'ë²•ì¸')),
  birthdate DATE,
  company TEXT,
  job_title TEXT,
  source TEXT,
  status TEXT NOT NULL DEFAULT 'new' CHECK (status IN ('new', 'contacted', 'consulting', 'closed')),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_customers_manager_id ON customers(manager_id);
CREATE INDEX idx_customers_status ON customers(status);
CREATE INDEX idx_customers_phone ON customers(phone);
```

### sources
```sql
CREATE TABLE sources (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL UNIQUE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## API ì—”ë“œí¬ì¸íŠ¸

### ì¸ì¦
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | /auth/me | í˜„ì¬ ì‚¬ìš©ì ì •ë³´ |

### ê³ ê°
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | /customers | ê³ ê° ëª©ë¡ (í˜ì´ì§€ë„¤ì´ì…˜) |
| GET | /customers/:id | ê³ ê° ìƒì„¸ |
| POST | /customers | ê³ ê° ë“±ë¡ |
| PATCH | /customers/:id | ê³ ê° ìˆ˜ì • |
| POST | /customers/bulk | ëŒ€ëŸ‰ ë“±ë¡ |

### íŒ€
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | /team/members | íŒ€ì› ëª©ë¡ (Managerìš©) |
| GET | /team/stats | íŒ€ í†µê³„ |

### ê´€ë¦¬ì
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | /admin/users | ì‚¬ìš©ì ëª©ë¡ |
| PATCH | /admin/users/:id | ì‚¬ìš©ì ìˆ˜ì • |
| GET | /sources | ì†ŒìŠ¤ ëª©ë¡ |
| POST | /admin/sources | ì†ŒìŠ¤ ì¶”ê°€ |
| DELETE | /admin/sources/:id | ì†ŒìŠ¤ ì‚­ì œ |

---

## í´ë” êµ¬ì¡°

```
crm2/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/              # Shadcn UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ customers/       # ê³ ê° ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ dashboard/       # ëŒ€ì‹œë³´ë“œ ìœ„ì ¯
â”‚   â”‚   â”œâ”€â”€ settings/        # ì„¤ì • ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ layout/          # ë ˆì´ì•„ì›ƒ (Sidebar, Header)
â”‚   â”‚   â””â”€â”€ auth/            # ì¸ì¦ (ProtectedRoute)
â”‚   â”œâ”€â”€ hooks/               # ì»¤ìŠ¤í…€ í›…
â”‚   â”œâ”€â”€ stores/              # Zustand ìŠ¤í† ì–´
â”‚   â”œâ”€â”€ services/            # API ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ pages/               # í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ types/               # TypeScript íƒ€ì…
â”‚   â”œâ”€â”€ lib/                 # ìœ í‹¸ë¦¬í‹° (cn, etc.)
â”‚   â””â”€â”€ utils/               # Supabase í´ë¼ì´ì–¸íŠ¸ ë“±
â”œâ”€â”€ worker/                  # Cloudflare Workers ë°±ì—”ë“œ
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ index.ts         # API ë¼ìš°íŠ¸
â”‚       â”œâ”€â”€ middleware/      # ì¸ì¦ ë¯¸ë“¤ì›¨ì–´
â”‚       â””â”€â”€ services/        # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”œâ”€â”€ public/
â””â”€â”€ ì„¤ì • íŒŒì¼ë“¤
```

---

## ê°œë°œ ê°€ì´ë“œ

### ë¡œì»¬ ê°œë°œ
```bash
# í”„ë¡ íŠ¸ì—”ë“œ
npm run dev          # http://localhost:3000

# ë°±ì—”ë“œ
cd worker
npm run dev          # http://localhost:8787
```

### ë¹Œë“œ
```bash
npm run build        # í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ
npm run lint         # ESLint ê²€ì‚¬
```

### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
1. `.env.example`ì„ `.env.local`ë¡œ ë³µì‚¬
2. Supabase í”„ë¡œì íŠ¸ í‚¤ ì…ë ¥
3. (ì„ íƒ) Juso API í‚¤ ì…ë ¥

---

## ì°¸ê³  ë¬¸ì„œ

### ë³´ì•ˆ ì·¨ì•½ì  ê´€ë ¨
- [React Server Components ì·¨ì•½ì ](https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components) - RSC ë¯¸ì‚¬ìš©ìœ¼ë¡œ ì˜í–¥ ì—†ìŒ
- [Vite ë³´ì•ˆ ê¶Œê³ ](https://github.com/vitejs/vite/security) - ìµœì‹  ë²„ì „ ì‚¬ìš©

### ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¬¸ì„œ
- [React Router v7](https://reactrouter.com/)
- [TanStack Query v5](https://tanstack.com/query/latest)
- [Zustand v5](https://github.com/pmndrs/zustand)
- [Shadcn UI](https://ui.shadcn.com/)
- [Hono](https://hono.dev/)

### ì£¼ì†Œ ë“± ì…ë ¥í¼ì— ì‚¬ìš©
- https://github.com/Devguru-J/kr-format
- https://github.com/Devguru-J/slick-address-kr

### ì…ë ¥í¼ ê·œì¹™ ë° ê²€ì¦
- ì „í™”ë²ˆí˜¸ëŠ” "010-" ì‚¬ì „ ì…ë ¥, ì‹¤ì œ ì…ë ¥ì€ ìˆ«ì 8ìë¦¬ë§Œ í•œë‹¤.
- ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
- ìƒë…„ì›”ì¼ì€ ì—°ë„(yyyy),ì›”(mm),ì¼(dd) ìˆœì„œë¡œ ì…ë ¥í•œë‹¤.(í˜•ì‹ ê²€ì¦)
- ì •í™•í•˜ê²Œ ì…ë ¥ë˜ì§€ í•­ëª©ì€ ì¦‰ì‹œ ë¼ë²¨ í•˜ë‹¨ì— ì‘ê³  ë¹¨ê°„ìƒ‰ ê¸€ì”¨ë¡œ ì•ˆë‚´ í‘œì‹œ
- esc í‚¤ë¡œ ì…ë ¥ì°½ì„ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ í•œë‹¤(ì‹¤ìˆ˜ ì…ë ¥ ë°©ì§€)
- ì •í™•í•œ ì´ë¦„ ì…ë ¥ì¸ì§€ í™•ì¸í•˜ëŠ” ë¡œì§ ì¶”ê°€
- ìƒë…„ì›”ì¼ì—ì„œ ì—°ë„ê°€ 6ìë¦¬ê¹Œì§€ ì…ë ¥ë˜ëŠ” í˜„ìƒ í•´ê²°

