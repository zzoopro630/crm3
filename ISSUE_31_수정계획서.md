# 이슈 #31: DB관리 시스템 개선사항 수정 계획서

## 📋 이슈 개요
- **이슈 번호**: #31
- **제목**: [개선] DB관리 시스템 개선사항
- **작성일**: 2026-01-09
- **담당자**: zzoopro630
- **브랜치**: issue-31-db-management-improvements

## 🎯 목표
DB관리 시스템의 핵심 기능을 개선하고 사용자 경험을 향상시킨다.

## 📝 상세 요구사항 분석

### 1. DB 관리 메뉴 화면 수정

#### 1.1 관리자 권한 강화
- **요구사항**: 관리자(F1, F2 등급)가 유입경로 수정할 수 있어야 됨
- **현재 상태**: 유입경로 수정 권한 확인 필요
- **구현 방안**: 
  - 권한 체크 로직 추가 (F1, F2 등급)
  - 유입경로 드롭다운 편집 가능하도록 수정
  - 수정 권한이 없는 사용자에게는 읽기전용으로 표시

#### 1.2 고객명 상세보기 구현
- **요구사항**: 고객명을 누르면 상세보기 구현 (메모, 계약 등 더 자세한 내용)
- **현재 상태**: 고객 관리 상세보기 기능 참조 필요
- **구현 방안**:
  - 고객명 클릭 이벤트 핸들러 추가
  - 상세보기 모달/페이지 구현
  - 메모, 계약 정보 표시 컴포넌트 개발
  - 고객 관리 상세보기 컴포넌트 재사용 또는 복제

#### 1.3 모바일 전화 걸기 기능
- **요구사항**: 모바일에서 전화번호 누르면 바로 전화 걸 수 있도록
- **현재 상태**: 데스크탑 전용
- **구현 방안**:
  - 모바일 기기 감지 로직 추가
  - `tel:` 프로토콜 링크 적용
  - 데스크탑에서는 기존 동작 유지

#### 1.4 상태 변경 기능
- **요구사항**: 배정된 담당자가 '상태'를 변경할 수 있어야 됨
- **현재 상태**: 상태 변경 권한 확인 필요
- **구현 방안**:
  - 상태 드롭다운 컴포넌트 추가
  - 담당자 권한 체크 로직
  - 상태 변경 API 연동
  - 실시간 상태 업데이트

#### 1.5 메모 누적 표시
- **요구사항**: 상세보기 화면에서 작성된 메모가 누적되어 보이도록
- **현재 상태**: 메모 기능 확인 필요
- **구현 방안**:
  - 메모 리스트 컴포넌트 구현
  - 메모 작성/수정/삭제 기능
  - 시간순 정렬
  - 작성자 정보 표시

#### 1.6 검색 기능 강화
- **요구사항**: 최적화된 검색 기능 (기간, 상태, 유입경로, 담당자별 sorting + 고객명, 연락처 검색)
- **현재 상태**: 기본 검색 기능만 있는 것으로 추정
- **구현 방안**:
  - 고급 검색 필터 컴포넌트 구현
  - 기간 검색 (시작일, 종료일)
  - 다중 필터 조합 검색
  - 정렬 기능 확장
  - 검색 결과 페이지네이션 최적화

### 2. 왼쪽 메뉴 바 수정

#### 2.1 2단 메뉴 축소 기능
- **요구사항**: 2단 메뉴 하위 메뉴 선택 시 상위메뉴 왼쪽으로 축소 (아이콘만 보이는 상태)
- **현재 상태**: 현재 메뉴 구조 확인 필요
- **구현 방안**:
  - 사이드바 상태 관리 (확장/축소)
  - 메뉴 레벨 감지 로직
  - 아이콘 전용 표시 모드
  - 애니메이션 효과 추가

#### 2.2 메뉴 시인성 개선
- **요구사항**: 하위 메뉴 선택 시, 어떤 메뉴에 들어와 있는건지 구별해서 표시
- **현재 상태**: 현재 메뉴 강조 표시 확인
- **구현 방안**:
  - 활성 메뉴 경로 표시
  - 비활성 메뉴 시각적 처리 (어둡게 등)
  - 배경색/텍스트 색상 대비 강화
  - 현재 위치 표시 (breadcrumb)

### 3. 라벨 방식 변경

#### 3.1 가변적 라벨 관리
- **요구사항**: 시스템이 정해놓는 방식 말고 가변적인 라벨 관리 필요
- **현재 상태**: 고정된 라벨 시스템
- **구현 방안**:
  - 라벨 관리 테이블 설계
  - 라벨 CRUD 기능 구현
  - 라벨 적용 컴포넌트 개발
  - 색상/아이콘 커스터마이징

### 4. 디자인 수정

#### 4.1 디자인 통일성
- **요구사항**: 고객관리 메뉴에 사용된 디자인을 DB관리 메뉴에도 적용
- **현재 상태**: 디자인 불일치 가능성
- **구현 방안**:
  - 고객관리 컴포넌트 분석
  - 공통 컴포넌트로 리팩토링
  - CSS 변수/테마 통일
  - 일관된 UI 패턴 적용

## 🔧 기술 구현 계획

### 백엔드 API 수정
```typescript
// 필요한 API 엔드포인트
- PATCH /api/db-customers/:id/status     // 상태 변경
- GET /api/db-customers/:id/notes        // 메모 목록
- POST /api/db-customers/:id/notes       // 메모 추가
- PATCH /api/db-customers/:id/source     // 유입경로 수정
- GET /api/db-customers/search           // 고급 검색
```

### 프론트엔드 컴포넌트 구조
```
src/pages/DBManagementPage.tsx          // 메인 페이지
src/components/db-management/
├── DBCustomerList.tsx                   // 고객 리스트
├── DBCustomerDetail.tsx                 // 상세보기
├── DBStatusSelector.tsx                 // 상태 선택기
├── DBAdvancedSearch.tsx                 // 고급 검색
├── DBNoteList.tsx                       // 메모 리스트
└── DBSourceEditor.tsx                   // 유입경로 편집기
```

### 데이터베이스 스키마 수정
```sql
-- 필요한 테이블/컬럼 추가
ALTER TABLE db_customers ADD COLUMN editable_source BOOLEAN DEFAULT false;
CREATE TABLE db_customer_notes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  customer_id UUID REFERENCES db_customers(id),
  author_id UUID REFERENCES profiles(id),
  content TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
CREATE TABLE db_labels (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  color TEXT DEFAULT '#gray',
  created_by UUID REFERENCES profiles(id)
);
```

## 📅 개발 일정

### 1주차: 기본 기능 구현
- [ ] 관리자 권한 강화 (유입경로 수정)
- [ ] 고객명 상세보기 기본 구조
- [ ] 모바일 전화 걸기 기능
- [ ] 상태 변경 기능

### 2주차: 고급 기능 구현
- [ ] 메모 누적 표시 기능
- [ ] 고급 검색 기능
- [ ] 라벨 관리 시스템
- [ ] 디자인 통일성 적용

### 3주차: UI/UX 개선
- [ ] 사이드바 메뉴 개선
- [ ] 반응형 디자인 최적화
- [ ] 접근성 개선
- [ ] 테스트 및 디버깅

## 🧪 테스트 계획

### 기능 테스트
- [ ] 관리자 권한별 기능 테스트
- [ ] 모바일/데스크탑 호환성 테스트
- [ ] 검색 기능 정확성 테스트
- [ ] 상태 변경 실시간 반영 테스트

### 사용자 테스트
- [ ] F1, F2 등급 사용자 테스트
- [ ] 모바일 사용자 테스트
- [ ] 대용량 데이터 처리 테스트

## 🚀 배포 계획

### 사전 준비
- [ ] 데이터베이스 백업
- [ ] 스테이징 환경 배포 테스트
- [ ] 롤백 계획 수립

### 배포 단계
1. **백엔드 API 배포**
2. **데이터베이스 스키마 마이그레이션**
3. **프론트엔드 배포**
4. **기능 검증 및 모니터링**

## 📝 완료 기준

### 필수 기능
- ✅ 관리자 유입경로 수정 가능
- ✅ 고객명 클릭 시 상세보기 표시
- ✅ 모바일 전화 걸기 기능 동작
- ✅ 담당자 상태 변경 가능
- ✅ 메모 누적 표시 기능
- ✅ 고급 검색 기능 정상 동작

### 디자인/UX
- ✅ 사이드바 메뉴 축소 기능
- ✅ 메뉴 시인성 개선
- ✅ 가변적 라벨 관리
- ✅ 고객관리와 디자인 통일

## 🔗 관련 자료

- [GitHub Issue #31](https://github.com/zzoopro630/crm3/issues/31)
- [고객관리 페이지 참조](src/pages/CustomersPage.tsx)
- [고객 상세보기 컴포넌트](src/components/customers/CustomerDetail.tsx)
- [권한 관리 로직](src/stores/authStore.ts)

---

**작성자**: zzoopro630  
**수정일**: 2026-01-09  
**상태**: 진행 중